<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞ 2048</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–∞ Inter –∏ —Ü–≤–µ—Ç–æ–≤ Tailwind -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        .game-grid {
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            aspect-ratio: 1 / 1; /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç–Ω—É—é —Ñ–æ—Ä–º—É */
        }

        .tile {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 900;
            color: #776e65;
            transition: transform 100ms ease-in-out, background-color 100ms ease-in-out;
            user-select: none;
            cursor: default;
        }

        /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –¥–ª—è –ø–ª–∏—Ç–æ–∫ */
        .tile-0 { background-color: #cdc1b4; font-size: 0; color: #cdc1b4;} /* Empty cell */
        .tile-2 { background-color: #eee4da; font-size: 1.5rem; color: #776e65; }
        .tile-4 { background-color: #ede0c8; font-size: 1.5rem; color: #776e65; }
        .tile-8 { background-color: #f2b179; font-size: 1.5rem; color: #f9f6f2; }
        .tile-16 { background-color: #f59563; font-size: 1.5rem; color: #f9f6f2; }
        .tile-32 { background-color: #f67c5f; font-size: 1.5rem; color: #f9f6f2; }
        .tile-64 { background-color: #f65e3e; font-size: 1.5rem; color: #f9f6f2; }
        .tile-128 { background-color: #edcf72; font-size: 1.25rem; color: #f9f6f2; }
        .tile-256 { background-color: #edcc61; font-size: 1.25rem; color: #f9f6f2; }
        .tile-512 { background-color: #edc850; font-size: 1.25rem; color: #f9f6f2; }
        .tile-1024 { background-color: #edc53f; font-size: 1rem; color: #f9f6f2; }
        .tile-2048 { background-color: #edc22e; font-size: 1rem; color: #f9f6f2; }
        /* Larger tiles have smaller font size to fit */
        .tile-4096, .tile-8192, .tile-16384 { background-color: #3c3a32; font-size: 0.8rem; color: #f9f6f2; }

        /* Mobile font size adjustments */
        @media (min-width: 640px) {
            .tile-2, .tile-4, .tile-8, .tile-16, .tile-32, .tile-64 { font-size: 2rem; }
            .tile-128, .tile-256, .tile-512 { font-size: 1.75rem; }
            .tile-1024, .tile-2048 { font-size: 1.5rem; }
            .tile-4096, .tile-8192, .tile-16384 { font-size: 1.25rem; }
        }

        /* Overlay for game end */
        #gameOverOverlay {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(2px);
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="app" class="w-full max-w-sm p-4 sm:p-6 space-y-4">
        <!-- Header and Scoreboard -->
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-4xl font-black text-[#776e65]">2048</h1>
            <div class="flex space-x-2">
                <!-- Score Card -->
                <div class="bg-[#bbada0] p-2 rounded-lg text-center min-w-[70px]">
                    <div class="text-xs font-bold uppercase text-[#eee4da]">–°–ß–ï–¢</div>
                    <div id="score" class="text-xl font-bold text-white">0</div>
                </div>
                <!-- Best Score Card -->
                <div class="bg-[#bbada0] p-2 rounded-lg text-center min-w-[70px] hidden sm:block">
                    <div class="text-xs font-bold uppercase text-[#eee4da]">–õ–£–ß–®–ò–ô</div>
                    <div id="bestScore" class="text-xl font-bold text-white">0</div>
                </div>
            </div>
        </header>

        <!-- Game Description and New Game Button -->
        <div class="flex justify-between items-center text-[#776e65] mb-4">
            <p class="text-sm">
                –°–≤–∞–π–ø–∞–π—Ç–µ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏) –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –ø–ª–∏—Ç–æ–∫.
                –¶–µ–ª—å: <span class="font-bold">2048</span>.
            </p>
            <button id="newGameButton"
                    class="px-4 py-2 bg-[#8f7a66] text-white font-bold rounded-lg hover:bg-[#9f8a76] transition shadow-lg">
                –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
        </div>

        <!-- Game Board Container -->
        <div class="relative bg-[#bbada0] p-3 rounded-xl shadow-2xl">
            <!-- Game Grid -->
            <div id="gameGrid" class="game-grid grid gap-3">
                <!-- Tiles will be generated here by JavaScript -->
            </div>

            <!-- Game Over Overlay (Hidden initially) -->
            <div id="gameOverOverlay" class="absolute inset-0 flex flex-col justify-center items-center rounded-xl transition duration-300 hidden">
                <p id="gameOverMessage" class="text-4xl font-bold text-[#776e65] mb-4 text-center"></p>
                <button id="tryAgainButton"
                        class="px-6 py-3 bg-[#8f7a66] text-white font-bold rounded-lg text-xl hover:bg-[#9f8a76] transition shadow-lg">
                    –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                </button>
            </div>
        </div>

        <!-- Instructions for Mini App (visible on mobile) -->
        <div class="text-center text-sm text-[#776e65] pt-4 block sm:hidden">
            <p>
                –î–ª—è –∏–≥—Ä—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–∞–π–ø—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ!
            </p>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        const GRID_SIZE = 4;
        let board = [];
        let score = 0;
        let bestScore = localStorage.getItem('bestScore2048') ? parseInt(localStorage.getItem('bestScore2048')) : 0;
        let isGameOver = false;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const gameGrid = document.getElementById('gameGrid');
        const scoreDisplay = document.getElementById('score');
        const bestScoreDisplay = document.getElementById('bestScore');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const newGameButton = document.getElementById('newGameButton');
        const tryAgainButton = document.getElementById('tryAgainButton');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø–æ–≤
        let touchstartX = 0;
        let touchstartY = 0;
        let touchendX = 0;
        let touchendY = 0;
        let isTouchMoved = false;

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ---

        /** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—É—é –∏–≥—Ä—É. */
        function initGame() {
            board = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0));
            score = 0;
            isGameOver = false;
            updateScore(0);
            updateBestScore(bestScore);
            gameOverOverlay.classList.add('hidden');
            gameOverOverlay.style.opacity = '0';

            // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è —Å–µ—Ç–∫–∏ (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
            gameGrid.innerHTML = '';
            for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
                const cell = document.createElement('div');
                cell.classList.add('tile', 'tile-0', 'rounded-lg', 'font-extrabold', 'shadow-inner');
                gameGrid.appendChild(cell);
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–≤–µ —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –ø–ª–∏—Ç–∫–∏
            addRandomTile();
            addRandomTile();
            renderBoard();
        }

        /** –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞. */
        function updateScore(newScore) {
            score = newScore;
            scoreDisplay.textContent = score;
            if (score > bestScore) {
                updateBestScore(score);
            }
        }

        /** –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Å—á–µ—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ localStorage. */
        function updateBestScore(newScore) {
            bestScore = newScore;
            bestScoreDisplay.textContent = bestScore;
            localStorage.setItem('bestScore2048', bestScore);
        }

        /** –î–æ–±–∞–≤–ª—è–µ—Ç –ø–ª–∏—Ç–∫—É —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º 2 (90%) –∏–ª–∏ 4 (10%) –≤ —Å–ª—É—á–∞–π–Ω—É—é –ø—É—Å—Ç—É—é —è—á–µ–π–∫—É. */
        function addRandomTile() {
            const emptyCells = [];
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (board[r][c] === 0) {
                        emptyCells.push({ r, c });
                    }
                }
            }

            if (emptyCells.length > 0) {
                const { r, c } = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                const newValue = Math.random() < 0.9 ? 2 : 4;
                board[r][c] = newValue;
            }
        }

        // --- –†–ï–ù–î–ï–†–ò–ù–ì –ò–ì–†–´ ---

        /** –û–±–Ω–æ–≤–ª—è–µ—Ç DOM, —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è. */
        function renderBoard() {
            const cells = gameGrid.children;
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const index = r * GRID_SIZE + c;
                    const tile = cells[index];
                    const value = board[r][c];

                    // –û—á–∏—Å—Ç–∫–∞ –∫–ª–∞—Å—Å–æ–≤
                    tile.className = '';
                    tile.classList.add('tile', 'rounded-lg', 'font-extrabold', 'shadow-inner');

                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    tile.classList.add(`tile-${value}`);

                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
                    tile.textContent = value > 0 ? value : '';
                }
            }
        }

        // --- –õ–û–ì–ò–ö–ê –î–í–ò–ñ–ï–ù–ò–Ø ---

        /**
         * –°–¥–≤–∏–≥–∞–µ—Ç –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–ª–∏—Ç–∫–∏ –≤ –æ–¥–Ω–æ–º —Ä—è–¥—É/—Å—Ç–æ–ª–±—Ü–µ.
         * @param {Array<number>} line - –†—è–¥ –∏–ª–∏ —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
         * @param {number} direction - 1 –¥–ª—è —Å–¥–≤–∏–≥–∞ –∫ –Ω–∞—á–∞–ª—É (–≤–ª–µ–≤–æ/–≤–≤–µ—Ä—Ö), -1 –¥–ª—è —Å–¥–≤–∏–≥–∞ –∫ –∫–æ–Ω—Ü—É (–≤–ø—Ä–∞–≤–æ/–≤–Ω–∏–∑).
         * @returns {{newLine: Array<number>, points: number}}
         */
        function slideAndMerge(line, direction) {
            let points = 0;
            let moved = false;
            let currentLine = line.filter(val => val !== 0); // –£–±–∏—Ä–∞–µ–º –Ω—É–ª–∏

            // 1. –°–ª–∏—è–Ω–∏–µ
            const processLine = [];
            let i = direction === 1 ? 0 : currentLine.length - 1;

            while (i >= 0 && i < currentLine.length) {
                const currentVal = currentLine[i];
                const nextVal = currentLine[i + direction];

                if (nextVal !== undefined && currentVal === nextVal) {
                    const mergedVal = currentVal * 2;
                    points += mergedVal;
                    processLine.push(mergedVal);
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–ª–∏—Ç–∫—É, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –±—ã–ª–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∞
                    i += (direction === 1 ? 2 : -2);
                    moved = true;
                } else {
                    processLine.push(currentVal);
                    i += direction;
                }
            }

            // 2. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω—É–ª—è–º–∏
            const diff = GRID_SIZE - processLine.length;
            const newZeros = Array(diff).fill(0);

            let newLine;
            if (direction === 1) { // –°–¥–≤–∏–≥ –≤–ª–µ–≤–æ/–≤–≤–µ—Ä—Ö (–Ω—É–ª–∏ —Å–ø—Ä–∞–≤–∞)
                newLine = processLine.concat(newZeros);
            } else { // –°–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ/–≤–Ω–∏–∑ (–Ω—É–ª–∏ —Å–ª–µ–≤–∞)
                newLine = newZeros.concat(processLine);
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø—Ä–æ–∏–∑–æ—à–ª–æ –ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ —Å–ª–∏—è–Ω–∏—è)
            if (!moved) {
                moved = line.some((val, index) => val !== newLine[index]);
            }

            return { newLine, points, moved };
        }


        /**
         * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ö–æ–¥ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.
         * @param {string} direction - 'up', 'down', 'left', 'right'.
         */
        function makeMove(direction) {
            if (isGameOver) return;

            let totalPoints = 0;
            let hasMoved = false;
            let newBoard = board.map(row => [...row]); // –ö–æ–ø–∏—è –¥–æ—Å–∫–∏

            for (let i = 0; i < GRID_SIZE; i++) {
                let line;

                // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä—è–¥–∞/—Å—Ç–æ–ª–±—Ü–∞
                if (direction === 'left' || direction === 'right') {
                    line = board[i];
                } else { // up/down
                    line = board.map(row => row[i]);
                }

                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–∏—è–Ω–∏—è
                const slideDirection = (direction === 'left' || direction === 'up') ? 1 : -1;
                const result = slideAndMerge(line, slideDirection);

                totalPoints += result.points;
                if (result.moved) {
                    hasMoved = true;
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
                if (direction === 'left' || direction === 'right') {
                    newBoard[i] = result.newLine;
                } else { // up/down
                    for (let j = 0; j < GRID_SIZE; j++) {
                        newBoard[j][i] = result.newLine[j];
                    }
                }
            }

            // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥–≤–∏–∂–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –ø–ª–∏—Ç–∫—É
            if (hasMoved) {
                board = newBoard;
                updateScore(score + totalPoints);
                addRandomTile();
                renderBoard();
                checkGameStatus();
            }
        }

        // --- –ü–†–û–í–ï–†–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø –ò–ì–†–´ ---

        /** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–∫–æ–Ω—á–µ–Ω–∞ –ª–∏ –∏–≥—Ä–∞ (–Ω–µ—Ç –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫ –∏ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤). */
        function checkGameStatus() {
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ 2048 (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –ø—Ä–∏—è—Ç–Ω–æ)
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (board[r][c] === 2048) {
                        endGame(true); // –ü–æ–±–µ–¥–∞
                        return;
                    }
                }
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
            const emptyCellsExist = board.flat().includes(0);
            if (emptyCellsExist) {
                return; // –ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
            }

            // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–∏—è–Ω–∏—è (—Å–æ—Å–µ–¥–Ω–∏–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–ª–∏—Ç–∫–∏)
            if (canMove()) {
                return; // –ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
            }

            // –ï—Å–ª–∏ –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫ –Ω–µ—Ç –∏ —Ö–æ–¥–æ–≤ –Ω–µ—Ç -> –ü–æ—Ä–∞–∂–µ–Ω–∏–µ
            endGame(false);
        }

        /** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã (—Å–ª–∏—è–Ω–∏—è). */
        function canMove() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE - 1; c++) {
                    if (board[r][c] === board[r][c + 1]) return true;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            for (let c = 0; c < GRID_SIZE; c++) {
                for (let r = 0; r < GRID_SIZE - 1; r++) {
                    if (board[r][c] === board[r + 1][c]) return true;
                }
            }
            return false;
        }

        /** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —ç–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã. */
        function endGame(isWin) {
            isGameOver = true;
            gameOverOverlay.classList.remove('hidden');
            gameOverOverlay.style.opacity = '1';

            if (isWin) {
                gameOverMessage.textContent = '–ü–û–ë–ï–î–ê! üéâ';
            } else {
                gameOverMessage.textContent = '–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê üòü';
            }
        }

        // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ---

        /** –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à –¥–ª—è –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤. */
        document.addEventListener('keydown', (e) => {
            let direction = '';
            switch (e.key) {
                case 'ArrowUp':
                    direction = 'up';
                    break;
                case 'ArrowDown':
                    direction = 'down';
                    break;
                case 'ArrowLeft':
                    direction = 'left';
                    break;
                case 'ArrowRight':
                    direction = 'right';
                    break;
            }

            if (direction) {
                e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                makeMove(direction);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞—á-—Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Mini App)
        gameGrid.addEventListener('touchstart', (e) => {
            touchstartX = e.changedTouches[0].screenX;
            touchstartY = e.changedTouches[0].screenY;
            isTouchMoved = false;
        }, false);

        gameGrid.addEventListener('touchmove', (e) => {
            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ—Ç–ª–∏—á–∏—Ç—å —Å–≤–∞–π–ø –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–∞—Å–∞–Ω–∏—è
            touchendX = e.changedTouches[0].screenX;
            touchendY = e.changedTouches[0].screenY;

            if (Math.abs(touchendX - touchstartX) > 10 || Math.abs(touchendY - touchstartY) > 10) {
                isTouchMoved = true;
            }
        }, false);

        gameGrid.addEventListener('touchend', (e) => {
            if (!isTouchMoved) return; // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —ç—Ç–æ –±—ã–ª–æ –ø—Ä–æ—Å—Ç–æ–µ –∫–∞—Å–∞–Ω–∏–µ

            const dx = touchendX - touchstartX;
            const dy = touchendY - touchstartY;
            const threshold = 50; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–≤–∞–π–ø–∞

            if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > threshold) {
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                makeMove(dx > 0 ? 'right' : 'left');
            } else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > threshold) {
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                makeMove(dy > 0 ? 'down' : 'up');
            }
            // –°–±—Ä–æ—Å isTouchMoved –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
            isTouchMoved = false;
        }, false);


        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–æ–≤–∞—è –∏–≥—Ä–∞"
        newGameButton.addEventListener('click', initGame);
        tryAgainButton.addEventListener('click', initGame);

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
    </script>
</body>
</html>
